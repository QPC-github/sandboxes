import{ClientApi as z}from"@storybook/client-api";import{StoryStore as G}from"@storybook/store";import{toId as J}from"@storybook/csf";import F from"global";import E from"util-deprecate";import{ClientApi as b}from"@storybook/client-api";import{PreviewWeb as C}from"@storybook/preview-web";import{createChannel as v}from"@storybook/channel-postmessage";import{addons as _}from"@storybook/addons";import{FORCE_RE_RENDER as O}from"@storybook/core-events";import{logger as u}from"@storybook/client-logger";function k(n){let a=null;Array.isArray(n)?a=n:n.keys&&(a=[n]);let i=new Map;if(a)a.forEach(r=>{r.keys().forEach(e=>{try{let o=r(e);i.set(typeof r.resolve=="function"?r.resolve(e):e,o)}catch(o){let t=o.message&&o.stack?`${o.message}
 ${o.stack}`:o.toString();u.error(`Unexpected error while loading ${e}: ${t}`)}})});else{let r=n();Array.isArray(r)&&r.every(e=>e.default!=null)?i=new Map(r.map((e,o)=>[`exports-map-${o}`,e])):r&&u.warn(`Loader function passed to 'configure' should return void or an array of module exports that all contain a 'default' export. Received: ${JSON.stringify(r)}`)}return i}function g(n,a){let i=a?.hot?.data?.lastExportsMap||new Map;a?.hot?.dispose&&(a.hot.accept(),a.hot.dispose(t=>{t.lastExportsMap=i}));let r=k(n),e=new Map;Array.from(r.entries()).filter(([,t])=>!!t.default).filter(([t,c])=>i.get(t)!==c).forEach(([t,c])=>e.set(t,c));let o=new Map;return Array.from(i.keys()).filter(t=>!r.has(t)).forEach(t=>o.set(t,i.get(t))),i=r,{added:e,removed:o}}var{window:d,FEATURES:T}=F,P=E(()=>{},"`configure()` is deprecated and will be removed in Storybook 7.0. \nPlease use the `stories` field of `main.js` to load stories.\nRead more at https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#deprecated-configure"),s=n=>()=>{throw new Error(`@storybook/client-api:${n} was removed in storyStoreV7.`)};function L(n,{decorateStory:a,render:i}={}){if(d&&(d.IS_STORYBOOK=!0),T?.storyStoreV7)return{forceReRender:s("forceReRender"),getStorybook:s("getStorybook"),configure:s("configure"),clientApi:{addDecorator:s("clientApi.addDecorator"),addParameters:s("clientApi.addParameters"),clearDecorators:s("clientApi.clearDecorators"),addLoader:s("clientApi.addLoader"),setAddon:s("clientApi.setAddon"),getStorybook:s("clientApi.getStorybook"),storiesOf:s("clientApi.storiesOf"),raw:s("raw")}};let r=v({page:"preview"});_.setChannel(r);let e=new b,o=new C,t=!1,c=p=>e.importFn(p);function l(){let p=e.getStoryIndex();o.onStoriesChanged({storyIndex:p,importFn:c})}return e.onImportFnChanged=l,e.storyStore=o.storyStore,d&&(d.__STORYBOOK_CLIENT_API__=e,d.__STORYBOOK_ADDONS_CHANNEL__=r,d.__STORYBOOK_PREVIEW__=o,d.__STORYBOOK_STORY_STORE__=o.storyStore),{forceReRender:()=>r.emit(O),getStorybook:()=>[],clientApi:e,configure(p,x,A,S=!0){S&&P(),e.addParameters({framework:p});let y=()=>{let{added:R,removed:w}=g(x,A);return Array.from(R.entries()).forEach(([m,h])=>e.facade.addStoriesFromExports(m,h)),Array.from(w.entries()).forEach(([m])=>e.facade.clearFilenameExports(m)),{render:i,...e.facade.projectAnnotations,renderToDOM:n,applyDecorators:a}};t?(y(),l()):(o.initialize({getStoryIndex:()=>e.getStoryIndex(),importFn:c,getProjectAnnotations:y}),t=!0)}}}export{z as ClientApi,G as StoryStore,L as start,J as toId};
