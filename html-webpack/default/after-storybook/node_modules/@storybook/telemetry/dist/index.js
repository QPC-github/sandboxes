"use strict";var ae=Object.create;var d=Object.defineProperty;var ie=Object.getOwnPropertyDescriptor;var ce=Object.getOwnPropertyNames;var ye=Object.getPrototypeOf,pe=Object.prototype.hasOwnProperty;var me=(e,t)=>{for(var o in t)d(e,o,{get:t[o],enumerable:!0})},B=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of ce(t))!pe.call(e,s)&&s!==o&&d(e,s,{get:()=>t[s],enumerable:!(n=ie(t,s))||n.enumerable});return e};var p=(e,t,o)=>(o=e!=null?ae(ye(e)):{},B(t||!e||!e.__esModule?d(o,"default",{value:e,enumerable:!0}):o,e)),le=e=>B(d({},"__esModule",{value:!0}),e);var be={};me(be,{computeStorybookMetadata:()=>U,getStorybookMetadata:()=>D,metaFrameworks:()=>O,sanitizeAddonName:()=>T,telemetry:()=>ke});module.exports=le(be);var M=require("@storybook/client-logger");var z=p(require("read-pkg-up")),b=require("detect-package-manager"),m=require("@storybook/core-common");var F=p(require("path")),j=async e=>{let t=Object.keys(e);return Promise.all(t.map(S))},S=async e=>{try{let t=require(F.default.join(e,"package.json"));return{name:e,version:t.version}}catch{return{name:e,version:null}}};var u=p(require("fs-extra")),g=p(require("path")),C=require("@storybook/core-common"),L={Nx:"nx.json",Turborepo:"turbo.json",Lerna:"lerna.json",Rush:"rush.json",Lage:"lage.config.json"},W=()=>{let e=(0,C.getProjectRoot)();if(!e)return;let o=Object.keys(L).find(s=>{let a=g.default.join(e,L[s]);return u.default.existsSync(a)});if(o)return o;if(!u.default.existsSync(g.default.join(e,"package.json")))return;let n=u.default.readJsonSync(g.default.join(e,"package.json"));if(n!=null&&n.workspaces)return"Workspaces"};var x=require("path");function Y(e){return e.replace(/[-[/{}()*+?.\\^$|]/g,"\\$&")}function v(e,t=x.sep){if(!e)return e;let o=process.cwd().split(t);for(;o.length>1;){let n=o.join(t),s=new RegExp(Y(n),"g");e=e.replace(s,"$SNIP");let a=o.join(t+t),c=new RegExp(Y(a),"g");e=e.replace(c,"$SNIP"),o.pop()}return e}function _(e,t=x.sep){e=JSON.parse(JSON.stringify(e,Object.getOwnPropertyNames(e)));let o=v(JSON.stringify(e),t);return JSON.parse(o)}var O={next:"Next","react-scripts":"CRA",gatsby:"Gatsby","@nuxtjs/storybook":"nuxt","@nrwl/storybook":"nx","@vue/cli-service":"vue-cli","@sveltejs/kit":"svelte-kit"},fe=e=>{let t=["angular","ember","html","preact","react","server","svelte","vue","vue3","webComponents"].map(o=>`${o}Options`);for(let o of t)if(o in e)return e[o]},T=e=>v(e).replace(/\/dist\/.*/,"").replace(/\.[mc]?[tj]?s[x]?$/,"").replace(/\/register$/,"").replace(/\/manager$/,"").replace(/\/preset$/,""),U=async({packageJson:e,mainConfig:t})=>{var A,$;let o={generatedAt:new Date().getTime(),builder:{name:"webpack5"},hasCustomBabel:!1,hasCustomWebpack:!1,hasStaticDirs:!1,hasStorybookEslint:!1,refCount:0},n={...e==null?void 0:e.dependencies,...e==null?void 0:e.devDependencies,...e==null?void 0:e.peerDependencies},s=Object.keys(n).find(r=>!!O[r]);if(s){let{version:r}=await S(s);o.metaFramework={name:O[s],packageName:s,version:r}}let a=W();a&&(o.monorepo=a);try{let r=await(0,b.detect)({cwd:(0,m.getProjectRoot)()}),i=await(0,b.getNpmVersion)(r);o.packageManager={type:r,version:i}}catch{}if(o.hasCustomBabel=!!t.babel,o.hasCustomWebpack=!!t.webpackFinal,o.hasStaticDirs=!!t.staticDirs,t.typescript&&(o.typescriptOptions=t.typescript),(A=t.core)!=null&&A.builder){let{builder:r}=t.core;o.builder={name:typeof r=="string"?r:r.name,options:typeof r=="string"?void 0:(r==null?void 0:r.options)??void 0}}t.refs&&(o.refCount=Object.keys(t.refs).length),t.features&&(o.features=t.features);let c={};t.addons&&t.addons.forEach(r=>{let i,V;typeof r=="string"?i=T(r):(V=r.options,i=T(r.name)),c[i]={options:V,version:void 0}}),(await j(c)).forEach(({name:r,version:i})=>{c[r].version=i});let l=Object.keys(c),y=Object.keys(n).filter(r=>r.includes("storybook")&&!l.includes(r)).reduce((r,i)=>({...r,[i]:{version:void 0}}),{});(await j(y)).forEach(({name:r,version:i})=>{y[r].version=i});let re=n.typescript?"typescript":"javascript",ne=!!n["eslint-plugin-storybook"],w=(0,m.getStorybookInfo)(e),se=(($=y[w.frameworkPackage])==null?void 0:$.version)||w.version;return{...o,storybookVersion:se,language:re,storybookPackages:y,framework:{name:w.framework,options:fe(t)},addons:c,hasStorybookEslint:ne}},k,D=async e=>{var s;if(k)return k;let{packageJson:t={}}=z.default.sync({cwd:process.cwd(),normalize:!1})||{},o=(e||(0,m.getStorybookConfiguration)(((s=t==null?void 0:t.scripts)==null?void 0:s.storybook)||"","-c","--config-dir"))??".storybook",n=(0,m.loadMainConfig)({configDir:o});return k=await U({mainConfig:n,packageJson:t}),k};var Z=p(require("isomorphic-unfetch")),J=p(require("fetch-retry")),E=require("nanoid");var G=p(require("path")),K=require("child_process"),Q=require("@storybook/core-common");var H=require("crypto"),q=e=>{let t=(0,H.createHash)("sha256");return t.update("storybook-telemetry-salt"),t.update(e),t.digest("hex")};var h,X=()=>{if(h)return h;let e;try{let t=(0,Q.getProjectRoot)(),o=G.default.relative(t,process.cwd()),n=(0,K.execSync)("git config --local --get remote.origin.url",{timeout:1e3,stdio:"pipe"});e=`${String(n).trim()}${o}`,h=q(e)}catch{}return h};var de="https://storybook.js.org/event-log",ue=(0,J.default)(Z.default),P=[],ge=(0,E.nanoid)();async function ee(e,t={retryDelay:1e3,immediate:!1}){let{payload:o,metadata:n,...s}=e,a={anonymousId:X(),inCI:process.env.CI==="true"},c=(0,E.nanoid)(),I={...s,eventId:c,sessionId:ge,metadata:n,payload:o,context:a},l;try{l=ue(de,{method:"POST",body:JSON.stringify(I),headers:{"Content-Type":"application/json"},retries:3,retryOn:[503,504],retryDelay:y=>2**y*(typeof(t==null?void 0:t.retryDelay)=="number"&&!Number.isNaN(t==null?void 0:t.retryDelay)?t.retryDelay:1e3)}),P.push(l),t.immediate?await Promise.all(P):await l}catch{}finally{P=P.filter(y=>y!==l)}}var R=p(require("chalk")),N=require("@storybook/core-common"),te="telemetry-notification-date",f=console,oe=async()=>{await N.cache.get(te,null)||(N.cache.set(te,Date.now()),f.log(),f.log(`${R.default.magenta.bold("attention")} => Storybook now collects completely anonymous telemetry regarding usage.`),f.log("This information is used to shape Storybook's roadmap and prioritize features."),f.log("You can learn more, including how to opt-out if you'd not like to participate in this anonymous program, by visiting the following URL:"),f.log(R.default.cyan("https://storybook.js.org/telemetry")),f.log())};var ke=async(e,t={},o={})=>{var s;await oe();let n={eventType:e,payload:t};try{n.metadata=await D(o==null?void 0:o.configDir)}catch(a){n.payload.error||(n.payload.error=a)}finally{let{error:a}=n.payload;a&&(n.payload.error=_(a)),(!n.payload.error||(o==null?void 0:o.enableCrashReports))&&((s=process.env)!=null&&s.STORYBOOK_DEBUG_TELEMETRY?(M.logger.info(`
[telemetry]`),M.logger.info(JSON.stringify(n,null,2))):await ee(n,o))}};0&&(module.exports={computeStorybookMetadata,getStorybookMetadata,metaFrameworks,sanitizeAddonName,telemetry});
