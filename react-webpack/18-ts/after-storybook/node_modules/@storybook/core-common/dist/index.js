"use strict";var Ve=Object.create;var R=Object.defineProperty;var Ge=Object.getOwnPropertyDescriptor;var Xe=Object.getOwnPropertyNames;var Ze=Object.getPrototypeOf,Qe=Object.prototype.hasOwnProperty;var er=(e,r)=>{for(var t in r)R(e,t,{get:r[t],enumerable:!0})},oe=(e,r,t,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of Xe(r))!Qe.call(e,n)&&n!==t&&R(e,n,{get:()=>r[n],enumerable:!(o=Ge(r,n))||o.enumerable});return e};var f=(e,r,t)=>(t=e!=null?Ve(Ze(e)):{},oe(r||!e||!e.__esModule?R(t,"default",{value:e,enumerable:!0}):t,e)),rr=e=>oe(R({},"__esModule",{value:!0}),e);var Jr={};er(Jr,{boost:()=>C,cache:()=>Ar,checkAddonOrder:()=>pr,createFileSystemCache:()=>_,filterPresetsConfig:()=>ge,findDistEsm:()=>Mr,getAutoRefs:()=>Se,getDirectoryFromWorkingDir:()=>Be,getFrameworkName:()=>br,getInterpretedFile:()=>u,getInterpretedFileWithExt:()=>J,getPresets:()=>be,getPreviewBodyTemplate:()=>Ir,getPreviewHeadTemplate:()=>Fr,getPreviewMainTemplate:()=>Nr,getProjectRoot:()=>dr,getRefs:()=>Rr,getStorybookConfiguration:()=>V,getStorybookInfo:()=>kr,globToRegexp:()=>ee,handlebars:()=>yr,interopRequireDefault:()=>$,interpolate:()=>Tr,isPreservingSymlinks:()=>Hr,loadAllPresets:()=>cr,loadCustomPresets:()=>q,loadEnvs:()=>lr,loadMainConfig:()=>hr,loadManagerOrAddonsFile:()=>Cr,loadPreset:()=>ye,loadPreviewOrConfigFile:()=>$r,logConfig:()=>jr,nodePathsToArray:()=>Y,normalizeStories:()=>Dr,normalizeStoriesEntry:()=>We,normalizeStoryPath:()=>K,readTemplate:()=>Lr,resolveAddonName:()=>ue,resolvePathInStorybookCache:()=>Z,serverRequire:()=>h,serverResolve:()=>j,stringifyEnvs:()=>gr,stringifyProcessEnvs:()=>ur,useProgressReporting:()=>Sr,validateConfigurationFiles:()=>w});module.exports=rr(Jr);var me=require("ts-dedent"),x=require("@storybook/node-logger"),le=require("path");var S=f(require("path"));var H=f(require("fs")),C=new Set([".js",".jsx",".ts",".tsx",".cjs",".mjs"]);function tr(){return[...Array.from(C)]}var ne=tr();function u(e){return ne.map(r=>e.endsWith(r)?e:`${e}${r}`).find(r=>H.default.existsSync(r))}function J(e){return ne.map(r=>({path:e.endsWith(r)?e:`${e}${r}`,ext:r})).find(r=>H.default.existsSync(r.path))}var se=!1;function $(e){if(se===!1){let{register:o}=require("esbuild-register/dist/node");se=!0,o({target:`node${process.version.slice(1)}`,format:"cjs",hookIgnoreNodeModules:!1,tsconfigRaw:`{
      "compilerOptions": {
        "strict": false,
        "skipLibCheck": true,
      },
    }`})}let r=require(e);return typeof r=="object"&&r!==null&&typeof r.default<"u"?r.default:r}function or(e){for(let r=0;r<e.length;r+=1){let t=J(e[r]);if(t)return t}}function h(e){let r=j(e);return r?$(r):null}function j(e){let r=Array.isArray(e)?e:[e],t=or(r);return t?t.path:null}var P=require("ts-dedent"),ie=f(require("util-deprecate")),ae=f(require("glob")),b=f(require("path"));var nr=(0,ie.default)(()=>{},P.dedent`
    Configuration files such as "config", "presets" and "addons" are deprecated and will be removed in Storybook 7.0.
    Read more about it in the migration guide: https://github.com/storybookjs/storybook/blob/master/MIGRATION.md#to-mainjs-configuration
  `),U=(e,r,t)=>{let o=b.default.resolve(t,e),n=b.default.resolve(t,r);throw new Error(P.dedent`
    You have mixing configuration files:
    ${o}
    ${n}
    "${e}" and "${r}" cannot coexist.
    Please check the documentation for migration steps: https://github.com/storybookjs/storybook/blob/master/MIGRATION.md#to-mainjs-configuration
  `)};function w(e){let r=`{${Array.from(C).join(",")}}`,t=c=>!!ae.default.sync(b.default.resolve(e,`${c}${r}`)).length,o=t("main"),n=t("config");if(!o&&!n)throw new Error(P.dedent`
      No configuration files have been found in your configDir (${b.default.resolve(e)}).
      Storybook needs either a "main" or "config" file.
    `);if(o&&n)throw new Error(P.dedent`
      You have both a "main" and a "config". Please remove the "config" file from your configDir (${b.default.resolve(e,"config")})`);let s=t("presets");o&&s&&U("main","presets",e),t("preview")&&n&&U("preview","config",e);let i=t("addons");t("manager")&&i&&U("manager","addons",e),(s||n||i)&&nr()}function q({configDir:e}){w(e);let r=h(S.default.resolve(e,"presets"));if(h(S.default.resolve(e,"main"))){let o=j(S.default.resolve(e,"main"));if(o)return[o]}return r||[]}var ce=f(require("resolve-from")),fe=(e,r)=>{try{return(0,ce.default)(e,r)}catch{return}},pe=e=>{try{return require.resolve(e)}catch{return}};var k=e=>e!=null&&typeof e=="object"&&Array.isArray(e)===!1,sr=e=>typeof e=="function";function ge(e){return e.filter(r=>{let t=typeof r=="string"?r:r.name;return!/@storybook[\\\\/]preset-typescript/.test(t)})}function de(e,r,t){return sr(e)?[...e({...t,...r})]:Array.isArray(e)?[...e]:[]}var ue=(e,r,t)=>{let o=r.startsWith("/")?pe:fe.bind(null,e),n=o(r);if(n){if(r.match(/\/(manager|register(-panel)?)(\.(js|ts|tsx|jsx))?$/))return{type:"virtual",name:r,managerEntries:[n]};if(r.match(/\/(preset)(\.(js|ts|tsx|jsx))?$/))return{type:"presets",name:n}}let s=n&&o(`${r}/package.json`),d=s&&(0,le.dirname)(s),i=g=>{if(o(`${r}${g}`))return`${d}${g}`},p=r,c=i("/manager"),a=i("/register")||i("/register-panel"),l=i("/preview"),m=o(`${p}/preset`);if(!(c||l)&&m)return{type:"presets",name:m};if(c||a||l||m){let g=[];return c&&g.push(c),!c&&a&&!m&&g.push(a),{type:"virtual",name:p,...g.length?{managerEntries:g}:{},...l?{previewAnnotations:[l]}:{},...m?{presets:[{name:m,options:t}]}:{}}}if(n)return{type:"presets",name:n}},ir=({configDir:e})=>r=>{let t=k(r)&&r.options||void 0,o=k(r)?r.name:r;try{let n=ue(e,o,t);return{...t?{options:t}:{},...n}}catch{x.logger.error(`Addon value should end in /manager or /preview or /register OR it should be a valid preset https://storybook.js.org/docs/react/addons/writing-presets/
${r}`)}};async function ar(e){if(e.type==="virtual"){let{type:t,name:o,...n}=e;return n}let r=e.name?e.name:e;return $(r)}async function ye(e,r,t){try{let o=e.name?e.name:e,n=e.options?e.options:{},s=await ar(e);if(typeof s=="function"&&(s=s(t,n)),Array.isArray(s))return A(s,r+1,t);if(k(s)){let{addons:d,presets:i,...p}=s,c=de(i,n,t),a=de(d,n,t);return[...await A([...c],r+1,t),...await A([...a.map(ir(t))].filter(Boolean),r+1,t),{name:o,preset:p,options:n}]}throw new Error(me.dedent`
      ${e} is not a valid preset
    `)}catch(o){let n=r>0?`  Failed to load preset: ${JSON.stringify(e)} on level ${r}`:`  Failed to load preset: ${JSON.stringify(e)}`;return x.logger.warn(n),x.logger.error(o),[]}}async function A(e,r,t){return!e||!Array.isArray(e)||!e.length?[]:(r||x.logger.info("=> Loading presets"),(await Promise.all(e.map(async o=>ye(o,r,t)))).reduce((o,n)=>o.concat(n),[]))}function he(e,r,t,o,n){let s=new Promise(d=>d(t));return e.length?e.reduce((d,{preset:i,options:p})=>{let c=i[r];if(!c)return d;if(typeof c=="function"){let a=c,l={preset:i,combinedOptions:{...n,...o,...p,presetsList:e,presets:{apply:async(m,g,E={})=>he(e,m,g,E,n)}}};return d.then(m=>a.call(l.preset,m,l.combinedOptions))}return d.then(a=>Array.isArray(a)&&Array.isArray(c)?[...a,...c]:k(a)&&k(c)?{...a,...c}:c)},s):s}async function be(e,r){let t=await A(e,0,r);return{apply:async(o,n,s={})=>he(t,o,n,s,r)}}async function cr(e){let{corePresets:r=[],overridePresets:t=[],...o}=e,n=[...r,...q(e),...t],s=ge(n);return s.length<n.length&&x.logger.warn("Storybook now supports TypeScript natively. You can safely remove `@storybook/preset-typescript`."),be(s,o)}var{logger:z}=require("@storybook/node-logger"),B=e=>r=>{let t=r.name||r;return t&&t.includes(e)},fr=(e,r,t)=>{let o=e.findIndex(B("@storybook/addon-essentials")),n=e.findIndex(B(r.name)),s=e.findIndex(B(t.name));return n===-1&&r.inEssentials&&(n=o),s===-1&&t.inEssentials&&(s=o),n!==-1&&s!==-1&&n<=s},pr=async({before:e,after:r,configFile:t,getConfig:o})=>{try{let n=await o(t);if(!(n!=null&&n.addons)){z.warn("Unable to find 'addons' config in main Storybook config");return}if(!fr(n.addons,e,r)){let s=" (or '@storybook/addon-essentials')",d=`'${e.name}'${e.inEssentials?s:""}`,i=`'${r.name}'${r.inEssentials?s:""}`;z.warn(`Expected ${d} to be listed before ${i} in main Storybook config.`)}}catch{z.warn(`Unable to load config file: ${t}`)}};var xe=require("lazy-universal-dotenv");var O=f(require("path")),W=f(require("find-up")),dr=()=>{let e;try{let r=W.default.sync(".git",{type:"directory"});r&&(e=e||O.default.join(r,".."))}catch{}try{let r=W.default.sync(".svn",{type:"directory"});r&&(e=e||O.default.join(r,".."))}catch{}try{e=e||__dirname.split("node_modules")[0]}catch{}return e||process.cwd()},Y=e=>e.split(process.platform==="win32"?";":":").filter(Boolean).map(r=>O.default.resolve("./",r)),mr=/^\.{1,2}([/\\]|$)/;function K(e){return mr.test(e)?e:`.${O.default.sep}${e}`}function lr(e={}){let r=e.production?"production":"development",t={NODE_ENV:process.env.NODE_ENV||r,NODE_PATH:process.env.NODE_PATH||"",STORYBOOK:process.env.STORYBOOK||"true",PUBLIC_URL:e.production?".":""};Object.keys(process.env).filter(i=>/^STORYBOOK_/.test(i)).forEach(i=>{t[i]=process.env[i]});let o=Object.entries(t).reduce((i,[p,c])=>Object.assign(i,{[p]:JSON.stringify(c)}),{}),{stringified:n,raw:s}=(0,xe.getEnvironment)({nodeEnv:t.NODE_ENV}),d={...t,...s};return d.NODE_PATH=Y(d.NODE_PATH||""),{stringified:{...o,...n},raw:d}}var gr=e=>Object.entries(e).reduce((r,[t,o])=>(r[t]=JSON.stringify(o),r),{}),ur=e=>Object.entries(e).reduce((t,[o,n])=>(t[`process.env.${o}`]=JSON.stringify(n),t),{"process.env.XSTORYBOOK_EXAMPLE_APP":'""'});var ve=f(require("handlebars"));function yr(e,r){return ve.default.compile(e)(r)}var Pe=f(require("path"));function hr({configDir:e}){return w(e),h(Pe.default.resolve(e,"main"))}var we=require("ts-dedent");async function br(e){let r=await e.presets.apply("framework","",e);if(!r)throw new Error(we.dedent`
      You must specify a framework in '.storybook/main.js' config.

      https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#framework-field-mandatory
    `);return typeof r=="object"?r.name:r}function V(e,r,t){if(!e)return null;let o=e.split(/[\s='"]+/),n=o.indexOf(t);return n===-1&&(n=o.indexOf(r)),n===-1?null:o[n+1]}var Ee=f(require("path")),Re=f(require("fs-extra"));var ke={"@storybook/react":"react","@storybook/vue":"vue","@storybook/vue3":"vue3","@storybook/angular":"angular","@storybook/html":"html","@storybook/web-components":"web-components","@storybook/polymer":"polymer","@storybook/ember":"ember","@storybook/marko":"marko","@storybook/mithril":"mithril","@storybook/riot":"riot","@storybook/svelte":"svelte","@storybook/preact":"preact","@storybook/rax":"rax","@storybook/server":"server"},Oe=console,xr=({dependencies:e,devDependencies:r,peerDependencies:t},o)=>[Object.entries(e||{}).find(o),Object.entries(r||{}).find(o),Object.entries(t||{}).find(o)],vr=e=>{let[r,t,o]=xr(e,([i])=>ke[i]),[n,s]=r||t||o||[],d=n?ke[n]:void 0;return r&&t&&r[0]===t[0]&&Oe.warn(`Found "${r[0]}" in both "dependencies" and "devDependencies". This is probably a mistake.`),r&&o&&r[0]===o[0]&&Oe.warn(`Found "${r[0]}" in both "dependencies" and "peerDependencies". This is probably a mistake.`),{version:s,framework:d,frameworkPackage:n,renderer:d,rendererPackage:n}},Pr=["ts","js","tsx","jsx","mjs","cjs"],G=(e,r)=>{let t=Ee.default.join(r,e),o=Pr.find(n=>Re.default.existsSync(`${t}.${n}`));return o?`${t}.${o}`:null},wr=e=>{var o;let r=".storybook",t=(o=e.scripts)==null?void 0:o.storybook;if(t){let n=V(t,"-c","--config-dir");n&&(r=n)}return{configDir:r,mainConfig:G("main",r),previewConfig:G("preview",r),managerConfig:G("manager",r)}},kr=e=>{let r=vr(e),t=wr(e);return{...r,...t}};var X=require("fs-extra"),I=require("path"),Ce=f(require("find-up")),$e=f(require("resolve-from")),je=require("@storybook/node-logger"),Se=async e=>{let r=await(0,Ce.default)("package.json",{cwd:e.configDir});if(!r)return{};let t=(0,I.dirname)(r),{dependencies:o=[],devDependencies:n=[]}=await(0,X.readJSON)(r)||{},s=Object.keys({...o,...n});return(await Promise.all(s.map(async i=>{try{let p=(0,$e.default)(t,(0,I.join)(i,"package.json")),{storybook:c,name:a,version:l}=await(0,X.readJSON)(p)||{};if(c!=null&&c.url)return{id:a,...c,version:l}}catch(p){if(p.code==="ERR_PACKAGE_PATH_NOT_EXPORTED")return;je.logger.warn(`unable to find package.json for ${i}`);return}}))).filter(Boolean).reduce((i,p)=>({...i,[p.id]:{id:p.id.toLowerCase(),url:Ae(p.url),title:p.title,version:p.version}}),{})},Or=e=>fetch(`${e}/iframe.html`).then(async({ok:r,status:t})=>{if(r){if(t!==200)return!1;let o=await fetch(`${e}/iframe.html`,{headers:{Accept:"application/json"}});if(o.ok&&(await o.json().catch(n=>({}))).loginUrl)return!1}return r},()=>!1),Ae=e=>e.replace(/\/$/,""),Er=e=>{let r=e.replace(/[A-Z]/g,t=>` ${t}`).replace(/[-_][A-Z]/gi,t=>` ${t.toUpperCase()}`).replace(/-/g," ").replace(/_/g," ");return`${r.substring(0,1).toUpperCase()}${r.substring(1)}`.trim()};async function Rr(e){let r=await e.presets.apply("refs",await Se(e));return Object.entries(r).forEach(([t,o])=>{if(o.disable){delete r[t];return}r[t.toLowerCase()]={...o,id:t.toLowerCase(),title:o.title||Er(o.id||t),url:Ae(o.url)}}),await Promise.all(Object.entries(r).map(async([t,o])=>{let n=await Or(o.url);r[t]={...o,type:n?"server-checked":"unknown"}})),r}var F=f(require("path")),Ie=require("@storybook/node-logger"),Fe=require("ts-dedent");function Cr({configDir:e}){let r=u(F.default.resolve(e,"addons")),t=u(F.default.resolve(e,"manager"));if((r||t)&&Ie.logger.info("=> Loading custom manager config"),r&&t)throw new Error(Fe.dedent`
      You have both a "addons.js" and a "manager.js", remove the "addons.js" file from your configDir (${F.default.resolve(e,"addons")})`);return t||r}var N=f(require("path")),Ne=require("ts-dedent");function $r({configDir:e}){let r=u(N.default.resolve(e,"config")),t=u(N.default.resolve(e,"preview"));if(r&&t)throw new Error(Ne.dedent`
      You have both a "config.js" and a "preview.js", remove the "config.js" file from your configDir (${N.default.resolve(e,"config")})`);return t||r}var Te=f(require("chalk"));function jr(e,r){console.log(Te.default.cyan(e)),console.dir(r,{depth:null})}var _e=f(require("pretty-hrtime")),De=e=>(0,_e.default)(process.hrtime(e)).replace(" ms"," milliseconds").replace(" s"," seconds").replace(" m"," minutes");var Sr=async(e,r,t)=>{var p;let o=0,n,s=()=>{};e.get("/progress",(c,a)=>{let l=!1,m=()=>{l=!0,a.end()};a.on("close",m),!(l||a.writableEnded)&&(a.setHeader("Cache-Control","no-cache"),a.setHeader("Content-Type","text/event-stream"),a.setHeader("Connection","keep-alive"),a.flushHeaders(),s=g=>{l||a.writableEnded||(a.write(`data: ${JSON.stringify(g)}

`),a.flush(),g.value===1&&m())})});let d=(c,a,l)=>{o=Math.max(c,o);let m={value:o,message:a.charAt(0).toUpperCase()+a.slice(1)};if(a==="building"){let g=l&&l.match(/(\d+)\/(\d+)/)||[],E=parseInt(g[1],10),M=parseInt(g[2],10);!Number.isNaN(E)&&!Number.isNaN(M)&&(m.modules={complete:E,total:M},n=M)}o===1&&(t.cache&&t.cache.set("modulesCount",n),m.message||(m.message=`Completed in ${De(r)}.`)),s(m)},i=await((p=t.cache)==null?void 0:p.get("modulesCount").catch(()=>{}))||1e3;return{handler:d,modulesCount:i}};var T=f(require("path")),Le=f(require("pkg-dir"));function Z(e){let r=process.cwd(),t=Le.default.sync(r),o;return t?o=T.default.resolve(t,"node_modules/.cache/storybook"):o=T.default.resolve(r,".cache/storybook"),T.default.join(o,e)}var Me=f(require("file-system-cache"));function _(e){return(0,Me.default)(e)}var Ar=_({basePath:Z("dev-server"),ns:"storybook"});var Q=f(require("path")),D=require("pkg-dir"),y=f(require("fs")),He=(e,r={})=>Object.entries(r).reduce((t,[o,n])=>t.replace(new RegExp(`%${o}%`,"g"),n),e);function Ir(e,r){let t=y.default.readFileSync(`${(0,D.sync)(__dirname)}/templates/base-preview-body.html`,"utf8"),o=Q.default.resolve(e,"preview-body.html"),n=t;return y.default.existsSync(o)&&(n=y.default.readFileSync(o,"utf8")+n),He(n,r)}function Fr(e,r){let t=y.default.readFileSync(`${(0,D.sync)(__dirname)}/templates/base-preview-head.html`,"utf8"),o=Q.default.resolve(e,"preview-head.html"),n=t;return y.default.existsSync(o)&&(n+=y.default.readFileSync(o,"utf8")),He(n,r)}function Nr(){return`${(0,D.sync)(__dirname)}/templates/preview.ejs`}var Tr=(e,r)=>Object.entries(r).reduce((t,[o,n])=>{let s=n.replace(/\\/g,"/").replace(/\$/g,"$$$");return t.replace(new RegExp(`{{${o}}}`,"g"),s)},e);var Je=require("picomatch");function ee(e){let r=(0,Je.makeRe)(e,{fastpaths:!1,noglobstar:!1,bash:!1});if(!r.source.startsWith("^"))throw new Error(`Invalid glob: >> ${e} >> ${r}`);return e.startsWith("./")?new RegExp(["^\\.",e.startsWith("./**")?"":"[\\\\/]",r.source.substring(1)].join("")):r}var qe=f(require("fs")),v=f(require("path")),ze=require("picomatch"),re=f(require("slash"));var L="",Ue="**/*.@(mdx|stories.mdx|stories.tsx|stories.ts|stories.jsx|stories.js)",_r=(e,r)=>{try{return qe.default.lstatSync(v.default.resolve(e,r)).isDirectory()}catch{return!1}},Be=({configDir:e,workingDir:r,directory:t})=>{let o=v.default.resolve(e,t),n=v.default.relative(r,o);return K(n)},We=(e,{configDir:r,workingDir:t})=>{let o;if(typeof e=="string"){let p=(0,ze.scan)(e);if(p.isGlob){let c=p.prefix+p.base,a=p.glob;o={titlePrefix:L,directory:c,files:a}}else _r(r,e)?o={titlePrefix:L,directory:e,files:Ue}:o={titlePrefix:L,directory:v.default.dirname(e),files:v.default.basename(e)}}else o={titlePrefix:L,files:Ue,...e};let n=(0,re.default)(o.files),{directory:s}=o,d=(0,re.default)(Be({configDir:r,workingDir:t,directory:s})).replace(/\/$/,""),i=ee(`${d}/${n}`);return{...o,directory:d,importPathMatcher:i}},Dr=(e,r)=>e.map(t=>We(t,r));var Ye=f(require("fs-extra"));async function Lr(e){return Ye.default.readFile(e,{encoding:"utf8"})}var te=f(require("path")),Ke=require("find-up"),Mr=(e,r)=>{let t=(0,Ke.sync)("package.json",{cwd:e});if(!t)throw new Error(`Could not find package.json in: ${e}`);let o=te.default.dirname(t);return te.default.join(o,"dist","esm",r)};function Hr(){let{NODE_OPTIONS:e,NODE_PRESERVE_SYMLINKS:r}=process.env;return!!r||(e==null?void 0:e.includes("--preserve-symlinks"))}0&&(module.exports={boost,cache,checkAddonOrder,createFileSystemCache,filterPresetsConfig,findDistEsm,getAutoRefs,getDirectoryFromWorkingDir,getFrameworkName,getInterpretedFile,getInterpretedFileWithExt,getPresets,getPreviewBodyTemplate,getPreviewHeadTemplate,getPreviewMainTemplate,getProjectRoot,getRefs,getStorybookConfiguration,getStorybookInfo,globToRegexp,handlebars,interopRequireDefault,interpolate,isPreservingSymlinks,loadAllPresets,loadCustomPresets,loadEnvs,loadMainConfig,loadManagerOrAddonsFile,loadPreset,loadPreviewOrConfigFile,logConfig,nodePathsToArray,normalizeStories,normalizeStoriesEntry,normalizeStoryPath,readTemplate,resolveAddonName,resolvePathInStorybookCache,serverRequire,serverResolve,stringifyEnvs,stringifyProcessEnvs,useProgressReporting,validateConfigurationFiles});
