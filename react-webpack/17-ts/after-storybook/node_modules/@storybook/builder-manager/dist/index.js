"use strict";var z=Object.create;var b=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Y=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty;var ee=(e,t)=>{for(var r in t)b(e,r,{get:t[r],enumerable:!0})},q=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of X(t))!Z.call(e,s)&&s!==r&&b(e,s,{get:()=>t[s],enumerable:!(o=Q(t,s))||o.enumerable});return e};var n=(e,t,r)=>(r=e!=null?z(Y(e)):{},q(t||!e||!e.__esModule?b(r,"default",{value:e,enumerable:!0}):r,e)),te=e=>q(b({},"__esModule",{value:!0}),e);var le={};ee(le,{bail:()=>W,build:()=>ie,compilation:()=>c,corePresets:()=>ae,executor:()=>J,getConfig:()=>M,overridePresets:()=>ne,start:()=>oe});module.exports=te(le);var l=require("path"),O=require("fs-extra"),H=n(require("express")),y=require("@storybook/node-logger"),k=require("@fal-works/esbuild-plugin-global-externals"),U=require("@yarnpkg/esbuild-plugin-pnp"),G=n(require("esbuild-plugin-alias"));var S=n(require("path")),E=require("fs-extra"),_=require("ejs");var B=async e=>(0,S.join)((0,S.dirname)(require.resolve("@storybook/builder-manager/package.json")),"templates",e),A=async e=>{let t=await B(e);return(0,E.readFile)(t,"utf8")};var N=async(e,t,r,o,s,a,i,m,u,{versionCheck:p,releaseNotesData:h,docsMode:F,previewUrl:x,serverChannelUrl:d})=>{let g=await r,f=await t,R=await e;return(0,_.render)(R,{title:f?`${f} - Storybook`:"Storybook",files:{js:s,css:o},globals:{FEATURES:JSON.stringify(await a,null,2),REFS:JSON.stringify(await i,null,2),LOGLEVEL:JSON.stringify(await m,null,2),DOCS_OPTIONS:JSON.stringify(await u,null,2),VERSIONCHECK:JSON.stringify(JSON.stringify(p),null,2),RELEASE_NOTES_DATA:JSON.stringify(JSON.stringify(h),null,2),PREVIEW_URL:JSON.stringify(x,null,2),SERVER_CHANNEL_URL:JSON.stringify(d,null,2)},head:g?await(0,E.readFile)(g,"utf8"):""})};var T=require("@storybook/ui/dist/globals");var I=require("path"),V=require("@storybook/core-common");var P=e=>{try{return Promise.resolve(require.resolve(e))}catch{return Promise.resolve(!1)}};var L=async e=>{let t=(0,V.getRefs)(e),r=e.presets.apply("features"),o=e.presets.apply("logLevel"),s=e.presets.apply("title"),a=e.presets.apply("docs",{}),i=A("template.ejs"),m=P((0,I.join)(e.configDir,"manager-head.html")),[u,p]=await Promise.all([J.get(),M(e)]);return{refs:t,features:r,title:s,docsOptions:a,template:i,customHead:m,instance:u,config:p,logLevel:o}};var v=require("fs-extra");async function C(e){var s,a;let t=await Promise.all(((a=(s=c)==null?void 0:s.outputFiles)==null?void 0:a.map(async i=>(await(0,v.ensureFile)(i.path).then(()=>(0,v.writeFile)(i.path,i.contents)),i.path.replace(e,"./sb-addons"))))||[]),r=t.filter(i=>i.endsWith(".mjs"));return{cssFiles:t.filter(i=>i.endsWith(".css")),jsFiles:r}}var c,w,M=async e=>{let[t,r,o]=await Promise.all([e.presets.apply("managerEntries",[]),P((0,l.join)(e.configDir,"manager")),B("addon.tsconfig.json")]);return{entryPoints:r?[...t,r]:t,outdir:(0,l.join)(e.outputDir||"./","sb-addons"),format:"esm",write:!1,outExtension:{".js":".mjs"},loader:{".js":"jsx",".png":"dataurl",".gif":"dataurl",".jpg":"dataurl",".jpeg":"dataurl",".svg":"dataurl",".webp":"dataurl",".webm":"dataurl"},target:["chrome100"],platform:"browser",bundle:!0,minify:!1,sourcemap:!0,jsxFactory:"React.createElement",jsxFragment:"React.Fragment",jsx:"transform",jsxImportSource:"react",tsconfig:o,legalComments:"external",plugins:[(0,G.default)({process:require.resolve("process/browser.js"),util:require.resolve("util/util.js"),assert:require.resolve("browser-assert")}),(0,k.globalExternals)(T.definitions),(0,U.pnpPlugin)()],define:{"process.env.NODE_ENV":"'production'","process.env":"{}",global:"window",module:"{}"}}},J={get:async()=>{let{build:e}=await import("esbuild");return e}},re=async function*({startTime:t,options:r,router:o}){y.logger.info("=> Starting manager..");let{config:s,customHead:a,features:i,instance:m,refs:u,template:p,title:h,logLevel:F,docsOptions:x}=await L(r);yield;let d=s.outdir;await(0,O.remove)(d),yield,c=await m({...s,watch:!0}),yield;let g=(0,l.join)((0,l.dirname)(require.resolve("@storybook/ui/package.json")),"dist");o.use("/sb-addons",H.default.static(d)),o.use("/sb-manager",H.default.static(g));let{cssFiles:f,jsFiles:R}=await C(d);yield;let j=await N(p,h,a,f,R,i,u,F,x,r);return yield,o.use("/",({path:D},$,K)=>{D==="/"?$.status(200).send(j):K()}),{bail:W,stats:{toJson:()=>({})},totalTime:process.hrtime(t)}},se=async function*({startTime:t,options:r}){if(!r.outputDir)throw new Error("outputDir is required");y.logger.info("=> Building manager..");let{config:o,customHead:s,features:a,instance:i,refs:m,template:u,title:p,logLevel:h,docsOptions:F}=await L(r);yield;let x=o.outdir,d=(0,l.join)((0,l.dirname)(require.resolve("@storybook/ui/package.json")),"dist"),g=(0,l.join)(r.outputDir,"sb-manager");c=await i({...o,minify:!0,watch:!1}),yield;let f=(0,O.copy)(d,g),{cssFiles:R,jsFiles:j}=await C(x);yield;let D=await N(u,p,s,R,j,a,m,h,F,r);return await Promise.all([(0,O.writeFile)((0,l.join)(r.outputDir,"index.html"),D),f]),y.logger.trace({message:"=> Manager built",time:process.hrtime(t)}),{toJson:()=>({})}},W=async()=>{if(w)try{await w.throw(new Error)}catch{}if(c&&c.stop)try{c.stop(),y.logger.warn("Force closed manager build")}catch{y.logger.warn("Unable to close manager build!")}},oe=async e=>{w=re(e);let t;do t=await w.next();while(!t.done);return t.value},ie=async e=>{w=se(e);let t;do t=await w.next();while(!t.done);return t.value},ae=[],ne=[];0&&(module.exports={bail,build,compilation,corePresets,executor,getConfig,overridePresets,start});
