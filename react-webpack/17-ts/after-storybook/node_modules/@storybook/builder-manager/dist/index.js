"use strict";var Q=Object.create;var P=Object.defineProperty;var X=Object.getOwnPropertyDescriptor;var Y=Object.getOwnPropertyNames;var Z=Object.getPrototypeOf,ee=Object.prototype.hasOwnProperty;var te=(e,t)=>{for(var r in t)P(e,r,{get:t[r],enumerable:!0})},q=(e,t,r,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Y(t))!ee.call(e,o)&&o!==r&&P(e,o,{get:()=>t[o],enumerable:!(s=X(t,o))||s.enumerable});return e};var l=(e,t,r)=>(r=e!=null?Q(Z(e)):{},q(t||!e||!e.__esModule?P(r,"default",{value:e,enumerable:!0}):r,e)),re=e=>q(P({},"__esModule",{value:!0}),e);var me={};te(me,{bail:()=>$,build:()=>ae,corePresets:()=>le,executor:()=>M,getConfig:()=>L,overridePresets:()=>ce,start:()=>ne});module.exports=re(me);var c=require("path"),O=require("fs-extra"),H=l(require("express")),y=require("@storybook/node-logger"),k=require("@fal-works/esbuild-plugin-global-externals"),G=require("@yarnpkg/esbuild-plugin-pnp"),W=l(require("esbuild-plugin-alias"));var S=l(require("path")),b=require("fs-extra"),_=require("ejs");var B=async e=>(0,S.join)((0,S.dirname)(require.resolve("@storybook/builder-manager/package.json")),"templates",e),I=async e=>{let t=await B(e);return(0,b.readFile)(t,"utf8")};var N=async(e,t,r,s,o,i,a,m,u,{versionCheck:p,releaseNotesData:h,docsMode:F,previewUrl:x,serverChannelUrl:d})=>{let g=await r,f=await t,R=await e;return(0,_.render)(R,{title:f?`${f} - Storybook`:"Storybook",files:{js:o,css:s},globals:{FEATURES:JSON.stringify(await i,null,2),REFS:JSON.stringify(await a,null,2),LOGLEVEL:JSON.stringify(await m,null,2),DOCS_OPTIONS:JSON.stringify(await u,null,2),VERSIONCHECK:JSON.stringify(JSON.stringify(p),null,2),RELEASE_NOTES_DATA:JSON.stringify(JSON.stringify(h),null,2),PREVIEW_URL:JSON.stringify(x,null,2),SERVER_CHANNEL_URL:JSON.stringify(d,null,2)},head:g?await(0,b.readFile)(g,"utf8"):""})};var T=require("@storybook/ui/dist/globals");var A=require("path"),U=require("@storybook/core-common");var E=e=>{try{return Promise.resolve(require.resolve(e))}catch{return Promise.resolve(!1)}};var C=async e=>{let t=(0,U.getRefs)(e),r=e.presets.apply("features"),s=e.presets.apply("logLevel"),o=e.presets.apply("title"),i=e.presets.apply("docs",{}),a=I("template.ejs"),m=E((0,A.join)(e.configDir,"manager-head.html")),[u,p]=await Promise.all([M.get(),L(e)]);return{refs:t,features:r,title:o,docsOptions:i,template:a,customHead:m,instance:u,config:p,logLevel:s}};var v=require("fs-extra"),V=require("path");async function J(e,t){let r=await Promise.all((t==null?void 0:t.map(async i=>{let{location:a,url:m}=se(i,e);return await(0,v.ensureFile)(a).then(()=>(0,v.writeFile)(a,i.contents)),m}))||[]),s=r.filter(i=>i.endsWith(".mjs"));return{cssFiles:r.filter(i=>i.endsWith(".css")),jsFiles:s}}function se(e,t){let r=e.path.replace(t,""),s=(0,V.join)(t,r),o=`./sb-addons${r.split("/").map(encodeURIComponent).join("/")}`;return{location:s,url:o}}var n,w,L=async e=>{let[t,r,s]=await Promise.all([e.presets.apply("managerEntries",[]),E((0,c.join)(e.configDir,"manager")),B("addon.tsconfig.json")]);return{entryPoints:r?[...t,r]:t,outdir:(0,c.join)(e.outputDir||"./","sb-addons"),format:"esm",write:!1,outExtension:{".js":".mjs"},loader:{".js":"jsx",".png":"dataurl",".gif":"dataurl",".jpg":"dataurl",".jpeg":"dataurl",".svg":"dataurl",".webp":"dataurl",".webm":"dataurl"},target:["chrome100"],platform:"browser",bundle:!0,minify:!1,sourcemap:!0,jsxFactory:"React.createElement",jsxFragment:"React.Fragment",jsx:"transform",jsxImportSource:"react",tsconfig:s,legalComments:"external",plugins:[(0,W.default)({process:require.resolve("process/browser.js"),util:require.resolve("util/util.js"),assert:require.resolve("browser-assert")}),(0,k.globalExternals)(T.definitions),(0,G.pnpPlugin)()],define:{"process.env.NODE_ENV":"'production'","process.env":"{}",global:"window",module:"{}"}}},M={get:async()=>{let{build:e}=await import("esbuild");return e}},oe=async function*({startTime:t,options:r,router:s}){y.logger.info("=> Starting manager..");let{config:o,customHead:i,features:a,instance:m,refs:u,template:p,title:h,logLevel:F,docsOptions:x}=await C(r);yield;let d=o.outdir;await(0,O.remove)(d),yield,n=await m({...o,watch:!0}),yield;let g=(0,c.join)((0,c.dirname)(require.resolve("@storybook/ui/package.json")),"dist");s.use("/sb-addons",H.default.static(d)),s.use("/sb-manager",H.default.static(g));let{cssFiles:f,jsFiles:R}=await J(d,n==null?void 0:n.outputFiles);yield;let j=await N(p,h,i,f,R,a,u,F,x,r);return yield,s.use("/",({path:D},z,K)=>{D==="/"?z.status(200).send(j):K()}),{bail:$,stats:{toJson:()=>({})},totalTime:process.hrtime(t)}},ie=async function*({startTime:t,options:r}){if(!r.outputDir)throw new Error("outputDir is required");y.logger.info("=> Building manager..");let{config:s,customHead:o,features:i,instance:a,refs:m,template:u,title:p,logLevel:h,docsOptions:F}=await C(r);yield;let x=s.outdir,d=(0,c.join)((0,c.dirname)(require.resolve("@storybook/ui/package.json")),"dist"),g=(0,c.join)(r.outputDir,"sb-manager");n=await a({...s,minify:!0,watch:!1}),yield;let f=(0,O.copy)(d,g),{cssFiles:R,jsFiles:j}=await J(x,n==null?void 0:n.outputFiles);yield;let D=await N(u,p,o,R,j,i,m,h,F,r);return await Promise.all([(0,O.writeFile)((0,c.join)(r.outputDir,"index.html"),D),f]),y.logger.trace({message:"=> Manager built",time:process.hrtime(t)}),{toJson:()=>({})}},$=async()=>{if(w)try{await w.throw(new Error)}catch{}if(n&&n.stop)try{n.stop(),y.logger.warn("Force closed manager build")}catch{y.logger.warn("Unable to close manager build!")}},ne=async e=>{w=oe(e);let t;do t=await w.next();while(!t.done);return t.value},ae=async e=>{w=ie(e);let t;do t=await w.next();while(!t.done);return t.value},le=[],ce=[];0&&(module.exports={bail,build,corePresets,executor,getConfig,overridePresets,start});
